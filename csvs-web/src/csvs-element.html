<link rel="import" href="../lib/jsorolla/src/lib/components/jso-help-menu.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-opencga-header.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-opencga-footer.html">

<link rel="import" href="csvs-content.html">
<link rel="import" href="csvs-menubar.html">
<link rel="import" href="csvs-home.html">
<link rel="import" href="csvs-search-element.html">
<link rel="import" href="csvs-stats-element.html">

<dom-module id="csvs-element">
    <style>
        :host {
            display: block;
            position: relative;
            cursor: default;
            font-size: 13px;
            height: 100%;
            background-color: var(--default-primary-color);
        }

        #sidemenu > div {
            font-size: 18px;
            box-sizing: border-box;
            padding: 7px 20px;
            border-bottom: 1px solid var(--divider-color);
        }

        #sidemenu > div:hover {
            cursor: pointer;
            background-color: var(--accent-color);
        }

        #sidemenu > div[active] {
            font-weight: normal;
        }

        div.icon {
            margin-left: 15px;
        }

        div.menu-button {
            padding: 0 10px;
        }

        div.menu-button:hover {
            background-color: rgba(0, 0, 0, 0.20);
        }

        #content {
            background-color: inherit;
            position: absolute;
            top: 60px;
            width: 100%;

            height: calc(100% - 60px);
            overflow-y: auto;

        }

        @media (max-width: 1100px) {
            .option-text {
                display: none;
            }
        }

        .userid {
            color: var(--accent-color);
            font-size: 16px;
        }

        jso-opencga-header {
            position: absolute;
            top: 0;
        }

        jso-opencga-footer {
            position: absolute;
            bottom: 0;
        }

    </style>
    <template>

        <csvs-content id="content" selected-option="{{selectedOption}}">
            <csvs-home data-option="home" hidden$="{{computeSelectedOption(selectedOption, 'home')}}"
                       selected-option="{{selectedOption}}"></csvs-home>
            <csvs-search-element data-option="search" hidden$="{{computeSelectedOption(selectedOption, 'search')}}"
                                 diseases="{{diseases}}" id="csvsSearchElement"></csvs-search-element>
            <csvs-stats-element data-option="stats"
                                hidden$="{{computeSelectedOption(selectedOption, 'stats')}}"
                                diseases="{{diseases}}" id="csvsStatsElement"
            ></csvs-stats-element>

        </csvs-content>

        <jso-opencga-header id="jsoHeader"
                            selected-option="{{selectedOption}}" hide-signup hide-login>
            <div class="icon">
                <img src="images/bier-text.svg" style="height: 50px;margin: 5px 0px 0 0;">
            </div>
            <span class="title">CIBERER Spanish Variant Server</span>
            <span class="description"></span>

            <csvs-menubar class="menu" id="teamMenuBar" selected-option="{{selectedOption}}">
                <div title="Search" class="hover" data-option="search" data-menu-type="unique">
                    <i class="fa fa-search"></i>
                    <span class="option-text">Search</span>
                </div>

                <div title="Stats" class="hover" data-option="stats" data-menu-type="unique">
                    <i class="fa fa-pie-chart"></i>
                    <span class="option-text">Stats</span>
                </div>
            </csvs-menubar>

            <jso-help-menu class="helpmenu" selectedOption="{{selectedOption}}">
                <a href="https://github.com/babelomics/csvs/wiki" target="_blank">
                    <i class="fa fa-book"></i>
                    &nbsp; Documentation
                </a>
                <a href="https://github.com/babelomics/csvs/wiki/tutorial" target="_blank">
                    <i class="fa fa-compass"></i>
                    &nbsp; Tutorial
                </a>
                <a href="https://github.com/babelomics/csvs/" target="_blank">
                    <i class="fa fa-github"></i>
                    &nbsp; Source code
                </a>
            </jso-help-menu>
        </jso-opencga-header>

        <jso-opencga-footer hidden$="{{computeSelectedOption(selectedOption, 'home')}}" menu-option="home">
            CSVS: created by Computational Genomics Department
            <br>
            Principe Felipe Research Center
            <br>
            2015
        </jso-opencga-footer>
    </template>
</dom-module>
<script>
    Polymer({
        is: 'csvs-element',
        properties: {
            selectedOption: {
                type: String,
                value: "home",
                notify: true,
                reflectToAttribute: true,
                observer: 'selectedOptionChanged'
            },
            diseases: {
                type: Array,
                value: function () {
                    return [];
                }
            }
        }, created: function () {
        },
        ready: function () {
            this.getDiseases();
            this.$.jsoHeader.allowLogin = false;
        },
        getDiseases: function (event, response) {
            var me = this;
            CSVSManager.diseases.list({
                request: {
                    async: false,
                    success: function (response) {
                        try {
                            var diseases = [];

                            var ibsPos = -1;
                            var mgpPos = -1;

                            for (var i = 0; i < response.result.length; i++) {
                                var elem = response.result[i];
                                if (elem.name === "IBS (107 Spanish individuals from 1000genomes)") {
                                    ibsPos = i;
                                } else if (elem.name === "MGP (267 healthy controls)") {
                                    mgpPos = i;
                                } else {
                                    diseases.push(elem);
                                }
                            }
                            if (ibsPos != -1) {
                                diseases.unshift(response.result[ibsPos]);
                            }
                            if (mgpPos != -1) {
                                diseases.unshift(response.result[mgpPos]);
                            }
                            me.diseases = diseases;
                        } catch (err) {
                            console.log("Error loading diseases: " + err);
                            me.diseases = [];
                        }
                    },
                    error: function (response) {
                        console.log("ERROR downloading diseases");
                        console.log(response);
                    }
                }
            });
        },
        computeSelectedOption: function (selectedOption, option) {
            return this.selectedOption != option;
        },
        selectedOptionChanged: function (neo, old) {
        },
        _swap: function (array, x, y) {
            var b = array[y];
            array[y] = array[x];
            array[x] = b;
        }
    });
</script>
