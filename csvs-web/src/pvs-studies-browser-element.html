<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymer-fontawesome/polymer-fontawesome.html">
<link rel="import" href="../bower_components/core-list/core-list.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">


<polymer-element name="es-studies-browser-element" attributes="studies">
    <template>
        <link rel="stylesheet" href="../lib/jsorolla/src/lib/components/jso-style.css">
        <style>
            :host {
                display: block;
                box-sizing: border-box;
                position: relative;
            }

            .studies {
                position: relative;
                padding: 15px 0 30px 0;
            }

        </style>


        <div class="studies" horizontal layout wrap center-justified>
            <template repeat="{{ study in studies }}">
                <es-study-element study="{{ study }}"></es-study-element>
            </template>
        </div>
        </div>

    </template>
    <script>
        Polymer({
            created: function () {
            },
            ready: function () {

            }
        })
        ;
    </script>
</polymer-element>


<polymer-element name="es-study-element" attributes="study">
    <template>
        <link rel="stylesheet" href="../lib/jsorolla/src/lib/components/jso-style.css">
        <link rel="stylesheet" href="../lib/jsorolla/src/lib/components/jso-panel.css">

        <style>
            :host {
                display: block;
                box-sizing: border-box;
                position: relative;
                margin: 20px 20px 0 0;

            }

            #study {
                background-color: #FFFFFF;
                height: 400px;
                width: 400px;

            }

            .container {
                position: relative;
                padding: 10px;
            }

            #chart {
                width: 380px;
                height: 270px;
            }

            .light {
                color: #666;
            }

        </style>

        <div class="panel panel-shadow" id="study">
            <div class="header" id="header" horizontal layout>
                <div class="text">{{ _formatText(study.sname) }}</div>
                <div class="headeractions" horizontal end-justified layout flex>
                    <!--<div class="text headerexpand" expanded?={{expanded}} on-click="{{handleExpand}}"></div>-->
                </div>
            </div>
            <div class="container" flex vertical layout>
                <div><span class="light">Disease:</span> {{ _formatText(study.meta.dis) }}</div>
                <div><span class="light">Phenotype:</span> {{ _formatText(study.meta.phe) }}</div>
                <div><span class="light">Description:</span>{{ _formatText(study.meta.dec) }}</div>
                <div><span class="light">Paper:</span> {{ _formatText(study.meta.paper) }}</div>
                <br>

                <div id="chart"></div>
            </div>
        </div>

    </template>
    <script>
        Polymer({
            created: function () {
            },
            ready: function () {
            },
            domReady: function () {
//                var bcr = this.$.chart.getBoundingClientRect();
//                this.chartHeight = 300;
//                this.chartWidth = 300;
                this._createBarColumnChart(this.study.sname);
            },
            handleExpand: function () {
                this.expanded = !this.expanded;
                if (this.expanded) {
                    this.style.position = 'absolute';
                    this.style.width = '100%';
                    this.style.height = '100%';
                    this.style.left = '0';
                    this.style.top = '0';
                    this.style.zIndex = 10000;

                    this.$.study.style.marginLeft = 'auto';
                    this.$.study.style.marginRight = 'auto';
                    this.$.study.style.height = '1000px';
                    this.$.study.style.width = '1000px';

//                    this.chartHeight = 800;
//                    this.chartWidth = 800;

//                    this.chart.setSize(800, 800, false);
                } else {
                    this.style.width = '';
                    this.style.height = '';
                    this.style.position =
                            this.style.top = '';
                    this.style.left = '';
                    this.style.zIndex = '';

                    this.$.study.style.marginLeft = '';
                    this.$.study.style.marginRight = '';
                    this.$.study.style.height = '';
                    this.$.study.style.width = '';
//                    this.$.study.style.zIndex = 10000;

//                    this.chartHeight = 200;
//                    this.chartWidth = 200;
//                    this.chart.setSize(200, 200, false);

                }
            },
            _createBarColumnChart: function (text) {

                var data = [
                    this.study.st.nVar,
//                    this.study.st.nSnp,
//                    this.study.st.nIndel,
                    this.study.st.nPass,
                    this.study.st.nTv,
                    this.study.st.nTi
                ];

                this.chart = new Highcharts.Chart({
                    chart: {
                        plotBackgroundColor: null,
                        plotBorderWidth: 1,//null,
                        plotShadow: false,
                        renderTo: this.$.chart,
                        type: 'column',
//                        height: this.chartHeight,
//                        width: this.chartWidth
                    },
                    title: {
//                        text: text + " Stats"
                        text: null
                    },
                    exporting: {
                        enabled: false
                    },
                    credits: {
                        enabled: false
                    },
                    xAxis: {
                        categories: [
                            "Variants", "Pass", "Transitions", "Transversions"
//                            "Variants", "SNPs", "INDELs", "Pass", "Transitions", "Transversions"
                        ]
                    },
                    yAxis: {
                        min: 0,
                        title: {
                            text: 'Count'
                        }
                    },
                    tooltip: {
                        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                        '<td style="padding:0"><b>{point.y}</b></td></tr>',
                        footerFormat: '</table>',
                        shared: true,
                        useHTML: true
                    },
                    legend: {
                        enabled: false
                    },
                    plotOptions: {
                        column: {
                            pointPadding: 0.2,
                            borderWidth: 0
                        }
                    },
                    series: [{
                        data: data
                    }]
                });
            },
            _formatText: function (text) {
                if (text) {

                    return Utils.formatText(text, "_").toLowerCase().replace(/(?:^|\s)\S/g, function (a) {
                        return a.toUpperCase();
                    });
                } else {
                    return "";
                }

            }
        })
        ;
    </script>
</polymer-element>


