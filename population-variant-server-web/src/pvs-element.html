<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymer-fontawesome/polymer-fontawesome.html">

<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-header.html">
<link rel="import" href="pvs-search-element.html">
<link rel="import" href="pvs-studies-browser-element.html">
<link rel="import" href="pvs-stats-element.html">
<link rel="import" href="pvs-home.html">
<link rel="import" href="pvs-menu.html">

<polymer-element name="pvs-element">
    <template>
        <link rel="stylesheet" href="../lib/jsorolla/src/lib/components/jso-style.css">
        <link rel="stylesheet" href="../lib/jsorolla/src/lib/components/jso-panel.css">
        <link rel="stylesheet" href="../lib/jsorolla/src/lib/components/jso-form.css">
        <link rel="stylesheet" href="../lib/jsorolla/src/lib/components/jso-dropdown.css">
        <style>
            :host {
                display: block;
                position: relative;
                box-sizing: border-box;
                font-size: 13px;

                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                cursor: default;

            }

            .content {
                background-color: #435f7a;
                position: relative;
                /*min-height: calc(100vh - 160px);*/
            }

            .content > * {
                min-height: calc(100vh - 160px);
            }

            .link {
                color: #CCCCCC;
                cursor: pointer;
                white-space: nowrap;
            }

            .link > a {
                color: #CCCCCC;
                text-decoration: none;
            }

            .link > a:visited {
                color: #CCCCCC;
            }

            .link:hover, .link > a:hover {
                color: #FFFFFF;
            }

            .announce {
                text-overflow: ellipsis;
                background-color: #ea4242;
                color: white;
                padding: 5px;
                font-size: 12px;
            }

            jso-project-browser {
                height: calc(100vh - 60px);
            }


        </style>
        <jso-header id="jsoHeader"
                    on-logout="{{handleLogout}}"
                    selectedOption="{{selectedOption}}"
                    allowLogin="{{allowLogin}}"
                    showMenu="true">
            <div class="title">CIBERER Spanish Variant Server</div>
            <div class="description">1.0.1</div>
            <pvs-menu class="menu" selectedOption="{{selectedOption}}"></pvs-menu>

            <jso-help-menu class="helpmenu" selectedOption="{{selectedOption}}">
                <div class="link">
                    <font-awesome icon="book"></font-awesome>
                    <a class="a" href="https://github.com/babelomics/pvs/wiki" target="_blank">
                        &nbsp; Documentation
                    </a>
                </div>
                <div class="link">
                    <font-awesome icon="compass"></font-awesome>
                    <a class="a" href="https://github.com/babelomics/pvs/wiki/Tutorial" target="_blank">
                        &nbsp; Tutorial
                    </a>
                </div>
                <div class="link">
                    <font-awesome icon="github"></font-awesome>
                    <a class="a" href="https://github.com/babelomics/pvs/" target="_blank">
                        &nbsp; Source code
                    </a>
                </div>
            </jso-help-menu>
        </jso-header>

        <div id="content">
            <template if="{{ selectedOption == 'home' || selectedOption == 'none' || selectedOption == ''}}">
                <pvs-home selectedOption="{{selectedOption}}"></pvs-home>
            </template>
            <template if="{{ selectedOption == 'search' }}">
                <es-search-element studies="{{ studies }}" staticStudies="{{ staticStudies }}"></es-search-element>
            </template>

            <template if="{{ selectedOption == 'studies' }}">
                <es-studies-browser-element studies="{{ studies }}"></es-studies-browser-element>
            </template>
            <template if="{{ selectedOption == 'stats' }}">
                <es-stats-element studies="{{ studies }}"></es-stats-element>
            </template>
        </div>

    </template>
    <script>
        Polymer({
            selectedOption: 'home',
            idSearch: null,
            created: function () {
                this.allowLogin = false;
                this.studies = [];
                this.staticStudies = [];
            },
            ready: function () {
                this.clear = true;
                this.getStudies();
            },
            getStudies: function (event, response) {
                var me = this;
                PVSManager.studies.list({
                    request: {
                        async: false,
                        success: function (response) {
                            try {
                                var studies = [];
                                var staticStudies = [];

                                for (var i = 0; i < response.response[0].result.length; i++) {
                                    var elem = response.response[0].result[i];
                                    if (elem.meta.sta == "false") {
                                        studies.push(elem);
                                    } else {
                                        staticStudies.push(elem);
                                    }

                                }

                                me.studies = studies;
                                me.staticStudies = staticStudies;

                            } catch (err) {
                                console.log("Error loading studies: " + err);
                                me.studies = [];
                                me.staticStudies = [];
                            }

//                             console.log("---------------- STUDIES -------------------");
//                             console.log(me.studies);
// 
//                             console.log("---------------- STATIC STUDIES -------------------");
//                             console.log(me.staticStudies);
                        },
                        error: function (response) {
                            console.log("ERROR downloading studies");
                            console.log(response);
                        }
                    }
                });
            }
        })
        ;
    </script>
</polymer-element>
